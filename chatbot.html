<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Legal Assistant ‚Äì InCrime</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --primary-dark: #0d2a3a;
  --accent-gold: #FFD700;
  --bg-sidebar: #f6f7f8;
  --text-dark: #333;
}

*{box-sizing:border-box; transition: all 0.3s ease;}
body{ margin:0; font-family:'Segoe UI',sans-serif; background: #fff; height:100vh; display:flex; flex-direction: column; overflow: hidden; }

/* Navbar */
 nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 60px;
      background: rgba(13, 42, 58, 0.95);
      color: #fff;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(8px);
    }

    nav .logo {
      font-size: 24px;
      font-weight: bold;
      letter-spacing: 1px;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 25px;
      margin: 0;
      padding: 0;
      margin-left: auto;
      margin-right: 20px;
    }

    nav ul li a {
      text-decoration: none;
      color: #fff;
      font-weight: 500;
      transition: 0.3s;
    }

    nav ul li a:hover {
      color: #FFD700;
    }

    nav button {
      background: #FFD700;
      border: none;
      color: #0d2a3a;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }

    nav button:hover {
      background: #f4d03f;
    }


.app-container { display: flex; flex: 1; margin-top: 60px; height: calc(100vh - 60px); }

/* Sidebar */
/* ===== SIDEBAR OVERLAY FIX ===== */
.sidebar{
  position: fixed;
  top: 60px;
  left: 0;
  height: calc(100vh - 60px);
  transform: translateX(-100%);
  z-index: 1000;
}

.sidebar.show{
  transform: translateX(0);
}

/* ===== MINI SIDEBAR ===== */
.sidebar-mini{
  width:56px;
  background: var(--primary-dark);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding-top:10px;
  gap:24px;

  position: fixed;
  top:60px; /* navbar ke bilkul neeche */
  left:0;
  height: calc(100vh - 60px);
  z-index: 900;
}


.sidebar-mini button{
  background:none;
  border:none;
  cursor:pointer;
  color:#fff;
}

.sidebar-mini svg{
  width:22px;
  height:22px;
}

.sidebar-mini button:hover{
  color: var(--accent-gold);
}
.sidebar-mini button:first-child{
  font-size:26px;
  color: var(--accent-gold);
  margin-top:10px;
}

.sidebar{ width:280px; background: var(--bg-sidebar); border-right: 1px solid #e0e0e0; display:flex; flex-direction:column; padding:20px; height: 100%; }
.new-chat-btn{ background: var(--primary-dark); color:#fff; border:none; padding:12px; border-radius:8px; cursor:pointer; font-weight:500; margin-bottom: 20px; text-align: center; }

.chat-history-title { font-size:11px; color:#999; text-transform:uppercase; margin-bottom:10px; letter-spacing: 1px; }
.chat-history{ list-style:none; padding:0; flex:1; overflow-y:auto; }
.chat-history li{ padding:10px 12px; border-radius:8px; margin-bottom:5px; cursor:pointer; font-size:14px; color: var(--text-dark); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.chat-history li:hover, .chat-history li.active{ background:#eceef0; font-weight: 600; }

/* Main Chat Section */
.main-content{ flex:1; display:flex; flex-direction:column; position:relative; background:#fff;
  transition: margin-left .35s ease;
}

body.sidebar-open .main-content{
  margin-left:280px;
}

#welcomeScreen{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding-top:145px; /* yahan magic number */
  z-index:5;
  text-align:center;
  background:#fff;
}

#welcomeScreen h1{
  font-size:20px;
  font-weight:600;
  color: var(--primary-dark);
  margin-bottom:10px; /* -80px hata diya */
}

.chat-box{ flex:1; padding:40px 18% 120px; overflow-y:auto; display:none; flex-direction:column; scroll-behavior: smooth; }
/* Centered input (before first message) */
.input-container.centered {
  position: absolute;
  bottom: 45%;
  left: 50%;
  transform: translate(-50%, 50%);
  width: 65%;
  max-width: 850px;
  z-index: 10;
}

/* Fixed bottom input (after first message) */
.input-container.bottom {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 65%;
  max-width: 850px;
  z-index: 10;
}
.input-wrapper{ background:#fff; border:1.5px solid #e0e0e0; border-radius:30px; padding:10px 15px 10px 22px; display:flex; align-items:center; gap:15px; box-shadow: 0 10px 30px rgba(0,0,0,0.04); }
.input-wrapper textarea{ flex:1; border:none; outline:none; font-size:16px; padding:5px 0; resize:none; max-height:150px; color: var(--text-dark); background: transparent; }

.action-btn{ background:none; border:none; cursor:pointer; display:flex; align-items:center; padding: 5px; color: #999; }
/* Jab mic chal raha ho to red ho jaye aur hile (Pulse) */
#micBtn.listening { 
    color: #ff4b4b !important; 
    animation: pulse 1s infinite; 
}

@keyframes pulse { 
    0% { transform: scale(1); } 
    50% { transform: scale(1.2); } 
    100% { transform: scale(1); } 
}
.sidebar-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
}

.close-btn{
  background:none;
  border:none;
  font-size:20px;
  cursor:pointer;
}
.chat-history li{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.del-chat{
  background:none;
  border:none;
  cursor:pointer;
  opacity:0;
}

.chat-history li:hover .del-chat{
  opacity:1;
}

body.dark-mode {
  --primary-dark: 111827#;      /* Navbar + Mini Sidebar same */
  --accent-gold: #fcd34d;
  --bg-sidebar: #f6f7f8;        /* Sidebar light hi rahe */
  --text-dark: #e5e7eb;

  background: #0f1115;          /* ‚≠ê NEW page background */
}

/* Sidebar same light */
body.dark-mode .sidebar {
  background: solid #e0e0e0;
}
body.dark-mode .new-chat-btn {
  background: #0d2a3a; /* original blue / primary-dark */
  color: #fff;         /* white text */
  border: none;        /* same style */
}
/* Dark mode mai chat history text ko readable banaye */
body.dark-mode .chat-history li {
    color: #e1ae07;  /* Normal state ka readable gray */
}

/* Hover ya active state pe contrast thoda aur strong rahe */
body.dark-mode .chat-history li:hover,
body.dark-mode .chat-history li.active {
    color: #111827;  /* Hover/active fully visible */
}

/* Main content background */
body.dark-mode .main-content {
  background: #0f1115;
}

/* Chat container */
body.dark-mode .chat-box {
  background: #181a20;
}

/* Bot message */
body.dark-mode .msg.bot {
  background: #23262d;
  border: 1px solid #2d313a;
  color: #e5e7eb;
}

/* User message same */
body.dark-mode .msg.user {
  background: var(--accent-gold);
  color: var(--primary-dark);
}

/* Input light hi rahe */
body.dark-mode .input-wrapper {
  background: #fff;
  border: 1.5px solid #e0e0e0;
  color: #333;
}

body.dark-mode .input-wrapper textarea {
  color: #333;
}

/* Welcome screen background fix */
body.dark-mode #welcomeScreen {
  background: #0f1115;
}
body.dark-mode #welcomeScreen h1 {
  color: var(--accent-gold);
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.35);
}
.send-pill{ background: #000; color:#fff; width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center; border:none; cursor:pointer; }
.send-pill:disabled{ background:#f0f0f0; color: #acacac; cursor:not-allowed; }

.mode-active #welcomeScreen { display: none; }
.mode-active .chat-box { display: flex; animation: fadeInUp 0.4s ease-out; }
@keyframes fadeInUp { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:none;} }

.msg{ max-width:85%; margin-bottom:25px; line-height:1.6; font-size:16px; padding: 12px 18px; border-radius: 15px; }
.user{ align-self:flex-end; background: var(--accent-gold); color: var(--primary-dark); font-weight: 500; }
.bot{ align-self:flex-start; color: var(--text-dark); background: #f7f7f8; border: 1px solid #eee; }
</style>
</head>

<body id="pageBody">

<nav>
    <div class="logo" onclick="resetChat()">‚öñÔ∏è InCrime</div>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="how-it-works.html">How It Works</a></li>
      <li><a href="application.html">Create Application </a></li>
      <li><a href="index.html#about">About</a></li>
      <li><a href="index.html#contact">Contact</a></li>
    </ul>
    <button class="login-btn">Login</button>
</nav>

<div class="app-container">
  <!-- MINI SIDEBAR -->
<div class="sidebar-mini">

  <!-- MENU -->
  <button onclick="toggleSidebar()" title="Menu">
    ‚ò∞
  </button>

  <!-- NEW CHAT -->
  <button onclick="startNewChat()" title="New Chat">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 20h9"/>
      <path d="M16.5 3.5a2.1 2.1 0 013 3L7 19l-4 1 1-4z"/>
    </svg>
  </button>

  <button class="login-btn" id="darkModeBtn" title="Toggle Dark/Light Mode">
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon">
    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
  </svg>
</button>

  <!-- HISTORY -->
  <button onclick="openHistory()" title="History">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="1 4 1 10 7 10"/>
      <path d="M3.5 15a9 9 0 102.1-9.4"/>
      <path d="M12 7v5l4 2"/>
    </svg>
  </button>

</div>
<aside class="sidebar" id="sidebar">

  <div class="sidebar-header">
    <span>Chats</span>
    <button class="close-btn" onclick="toggleSidebar()">‚úï</button>
  </div>

  <button class="new-chat-btn" onclick="startNewChat()">Ôºã New Chat</button>
  <div class="chat-history-title">Recent Threads</div>
  <ul class="chat-history" id="historyList"></ul>

</aside>


  <main class="main-content">
    <div id="welcomeScreen">
      <h1>Hi,How can I help you with legal matters today?</h1>
    </div>
    <div class="chat-box" id="chatBox"></div>
    <div class="input-container centered">
      <div class="input-wrapper">
        <input type="file" id="filePicker" style="display:none" onchange="handleFile(this)">
        <button class="action-btn" onclick="document.getElementById('filePicker').click()" title="Upload Document"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg></button>
        <textarea id="chatInput" rows="1" placeholder="Message InCrime..." oninput="autoResize()"></textarea>
        <button class="action-btn" id="micBtn" onclick="startVoice()" title="Voice Input"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg></button>
        <button class="send-pill" id="sendBtn" onclick="sendMessage()" disabled><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg></button>
      </div>
    </div>
  </main>
</div>

<script>
let sessions = JSON.parse(localStorage.getItem("crime_chats")) || [];
let currentSessionId = null;

const input = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');
const chatBox = document.getElementById('chatBox');
const historyList = document.getElementById('historyList');

function autoResize() {
  sendBtn.disabled = !input.value.trim();
  input.style.height = 'auto';
  input.style.height = input.scrollHeight + 'px';
}

// --- VOICE & FILE (RE-FIXED) ---
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (SpeechRecognition) {
    const recognition = new SpeechRecognition();
    recognition.continuous = false; 

    recognition.onstart = () => {
        document.getElementById('micBtn').classList.add('listening');
        input.placeholder = "Listening... Bolain...";
    };

    recognition.onresult = (e) => { 
        input.value = e.results[0][0].transcript; // Voice ko text mein badla
        autoResize(); 
        recognition.stop(); // Khud band ho jaye
    };

    recognition.onend = () => {
        document.getElementById('micBtn').classList.remove('listening');
        input.placeholder = "Message InCrime...";
    };

    function startVoice() { recognition.start(); }
}

function handleFile(p) { 
    if(p.files.length) { 
        input.value = "üìÑ Attachment: " + p.files[0].name; 
        autoResize(); 

        // Show preview in chat
        appendMsgUI("Uploaded file: " + p.files[0].name, 'bot');
    } 
}


// --- CHAT PERSISTENCE LOGIC ---
function renderHistory() {
  historyList.innerHTML = "";
  sessions.forEach((s,index) => {
    const li = document.createElement('li');
    li.innerHTML = `
      <span>${s.title}</span>
      <button class="del-chat" title="Delete chat">‚úï</button>
    `;

    li.querySelector("span").onclick = () => loadSession(s.id);

    li.querySelector(".del-chat").onclick = (e) => {
      e.stopPropagation();
      sessions.splice(index,1);
      localStorage.setItem("crime_chats", JSON.stringify(sessions));
      renderHistory();
    };

    historyList.appendChild(li);
  });
}


function startNewChat() {
  currentSessionId = Date.now();
  document.getElementById('pageBody').classList.remove('mode-active');
  chatBox.innerHTML = "";
  input.value = "";
  autoResize();
}

function loadSession(id) {
  currentSessionId = id;
  const s = sessions.find(x => x.id === id);
  document.getElementById('pageBody').classList.add('mode-active');
  chatBox.innerHTML = "";
  s.messages.forEach(m => appendMsgUI(m.text, m.role));
  renderHistory();
}

function sendMessage() {
  const text = input.value.trim();
  if(!text) return;

  // Move input to bottom after first message
  const inputContainer = document.querySelector('.input-container');
  if(inputContainer.classList.contains('centered')) {
    inputContainer.classList.remove('centered');
    inputContainer.classList.add('bottom');
  }

  // Activate chat box
  document.getElementById('pageBody').classList.add('mode-active');

  if(!currentSessionId) currentSessionId = Date.now();
  let session = sessions.find(x => x.id === currentSessionId);
  if(!session) {
    session = { id: currentSessionId, title: text.slice(0,25), messages: [] };
    sessions.unshift(session);
  }

  session.messages.push({role: 'user', text: text});
  appendMsgUI(text, 'user');
  input.value = "";
  autoResize();

setTimeout(() => {
    const reply = "I am analyzing your legal query...";
    session.messages.push({role: 'bot', text: reply});
    appendMsgUI(reply, 'bot');
    localStorage.setItem("crime_chats", JSON.stringify(sessions));
    renderHistory();
}, 700);
}

function appendMsgUI(text, role) {
  const d = document.createElement('div');
  d.className = `msg ${role}`;
d.textContent = text; 
chatBox.appendChild(d);
chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
}

function resetChat() { startNewChat(); }

input.addEventListener("keydown", e => { if(e.key === "Enter" && !e.shiftKey) { e.preventDefault(); sendMessage(); } });

renderHistory();
const sidebar = document.getElementById("sidebar");

function toggleSidebar(){
  sidebar.classList.toggle("show");
  document.body.classList.toggle("sidebar-open");
}

function openHistory(){
  sidebar.classList.add("show");
  document.body.classList.add("sidebar-open");
}

document.addEventListener("click", function(e){
  if(
    sidebar.classList.contains("show") &&
    !sidebar.contains(e.target) &&
    !e.target.closest(".sidebar-mini") &&
    !e.target.closest(".input-container")   // ‚≠ê NEW FIX
  ){
    sidebar.classList.remove("show");
  }
});

document.getElementById('darkModeBtn').addEventListener('click', () => {
  document.body.classList.toggle('dark-mode');
});


</script>

</body>
</html>
